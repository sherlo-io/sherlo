name: Sherlo - Build Native Dev Apps

# Run manually when native code changes
on:
  workflow_dispatch:

jobs:
  sherlo-native-dev-builds:
    name: Build native development apps
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¦ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 'lts/*'

      - name: ğŸ“¥ Install dependencies
        run: yarn install

      - name: ğŸ—ï¸ Build native development apps
        # Builds native development / simulator apps
        # used for EAS Update testing
        #
        # Run this workflow only when native code changes
        # for example iOS or Android code, native modules,
        # config plugins, permissions
        #
        # This example uses EAS Build with custom
        # "development-simulator" profile
        #
        # EAS Build requires authentication token:
        # 1. Get token at: https://expo.dev/accounts/[account]/settings/access-tokens
        # 2. Add to GitHub repository secrets as EXPO_TOKEN
        run: |
          npx eas-cli build --local --profile development-simulator --platform android --output builds/android.apk
          npx eas-cli build --local --profile development-simulator --platform ios --output builds/ios.tar.gz
        env:
          EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}

      - name: ğŸ“¦ Upload native development build artifacts
        # Uploads native development app builds
        # to be reused by EAS Update workflows
        uses: actions/upload-artifact@v4
        with:
          name: sherlo-native-dev-builds
          path: builds/
