name: Build native apps for simulators (development)

# Run this workflow manually when native code changes
on:
  workflow_dispatch:

jobs:
  build-development-simulator:
    name: Build development simulator apps
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¦ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ”§ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 'lts/*'

      - name: ğŸ“¥ Install dependencies
        run: yarn install

      - name: ğŸ—ï¸ Build native apps for development testing
        # Builds native apps intended to be reused across multiple test runs
        #
        # This workflow should be triggered only when native code changes
        #
        # The "development-simulator" profile should be defined in eas.json
        # and produce simulator-ready builds for iOS and Android
        #
        # EAS Build requires an authentication token:
        # 1. Get token at: https://expo.dev/accounts/[account]/settings/access-tokens
        # 2. Add to GitHub repository secrets as EXPO_TOKEN
        run: |
          npx eas-cli build --local --profile development-simulator --platform android --output builds/android.apk
          npx eas-cli build --local --profile development-simulator --platform ios --output builds/ios.tar.gz
        env:
          EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}

      - name: ğŸ“¤ Upload native build artifacts
        # Uploads native builds so they can be reused by other workflows
        uses: actions/upload-artifact@v4
        with:
          name: development-native-builds
          path: builds/
