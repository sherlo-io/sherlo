name: Sherlo Tests

on:
  push:
    branches: [michal/eas-build-hooks]
  workflow_dispatch:
    inputs:
      skip_build:
        description: 'Skip the build steps'
        required: false
        default: false
        type: boolean
      run_sherlo_sync_tests:
        description: 'Sherlo Sync upload tests'
        required: true
        type: boolean
        default: true
      run_sherlo_async_tests:
        description: 'Sherlo Async upload tests'
        required: true
        type: boolean
        default: true
      run_sherlo_eas_hooks_tests:
        description: 'Sherlo EAS hooks tests'
        required: true
        type: boolean
        default: true

jobs:
  update_builds:
    if: ${{ !github.event.inputs.skip_build || github.event_name == 'push' }}
    uses: sherlo-io/sherlo/.github/workflows/update_builds.yml@michal/eas-build-hooks
    with:
      profile: 'preview'
      SHERLO_BOT_APP_ID: ${{ secrets.SHERLO_BOT_APP_ID }}
      SHERLO_BOT_PRIVATE_KEY: ${{ secrets.SHERLO_BOT_PRIVATE_KEY }}
      EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}

  run_sherlo_sync_tests:
    if: ${{ github.event.inputs.run_sherlo_sync_tests || github.event_name == 'push' }}
    needs: [update_builds]
    uses: sherlo-io/sherlo/.github/workflows/run_sherlo_sync.yml@michal/eas-build-hooks
    with:
      skip_build: true
      SHERLO_TOKEN: ${{ secrets.SHERLO_TOKEN }}

  run_sherlo_async_tests:
    if: ${{ github.event.inputs.run_sherlo_async_tests || github.event_name == 'push' }}
    needs: [update_builds]
    uses: sherlo-io/sherlo/.github/workflows/run_sherlo_async.yml@michal/eas-build-hooks
    with:
      skip_build: true
      SHERLO_TOKEN: ${{ secrets.SHERLO_TOKEN }}

  run_sherlo_eas_hooks_tests:
    if: ${{ github.event.inputs.run_sherlo_eas_hooks_tests || github.event_name == 'push' }}
    uses: sherlo-io/sherlo/.github/workflows/run_sherlo_eas_hooks.yml@michal/eas-build-hooks
    with:
      EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}
      SHERLO_TOKEN: ${{ secrets.SHERLO_TOKEN }}
